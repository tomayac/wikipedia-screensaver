"use strict";!function(r){var l,e,n={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},c=n.w3;for(e in n)if(n[e].enabled in r){l=n[e];break}function t(e,n){var t=r.createEvent("Event");t.initEvent(e,!0,!1),n.dispatchEvent(t)}function i(e){return function(n,t){e!==c.exit||r[l.element]?(r.addEventListener(l.events.change,function e(){n(),r.removeEventListener(l.events.change,e,!1)},!1),r.addEventListener(l.events.error,function e(){t(new TypeError),r.removeEventListener(l.events.error,e,!1)},!1)):setTimeout(function(){t(new TypeError)},1)}}c.enabled in r||!l||(r.addEventListener(l.events.change,function(e){e.stopPropagation(),e.stopImmediatePropagation(),r[c.enabled]=r[l.enabled],r[c.element]=r[l.element],t(c.events.change,e.target)},!1),r.addEventListener(l.events.error,function(e){t(c.events.error,e.target)},!1),r[c.enabled]=r[l.enabled],r[c.element]=r[l.element],r[c.exit]=function(){var e=r[l.exit]();return!e&&Promise?new Promise(i(c.exit)):e},Element.prototype[c.request]=function(){var e=this[l.request].apply(this,arguments);return!e&&Promise?new Promise(i(c.request)):e})}(document),function(e,c,i,a,s){var o=a("#tiles-container"),u=a("#sound"),d=a("#fullscreen"),n="not all"!==c.matchMedia("(prefers-reduced-motion)").media,m=!1;if(n){var t=c.matchMedia("(prefers-reduced-motion: reduce)");m=t.matches;var r=function(){m=t.matches,o.style.display=m?"block":"flex"};r(),t.addListener(r)}function f(e){return 0===Object.keys(e).length&&JSON.stringify(e)===JSON.stringify({})}function v(n){var t={};return speechSynthesis.getVoices().filter(function(e){return!n||/^(Google|Microsoft)/.test(e.name)}).map(function(e){t[e.lang.substr(0,2)]=e}),t}var h={},k=0,g=function(e,n){var t=s("div");t.className="tile",t.style.backgroundColor=m?"#eee":"#"+(~~(Math.random()*(1<<24))).toString(16);var r=s("img");r.onerror=function(){return r.src="img/neutral.png"},r.src="img/"+n.split("-")[0]+".svg",r.className="flag",t.appendChild(r);var l=s("a");l.className="label",l.textContent=""+e.title,l.href=e.server_url+"/wiki/"+e.title.replace(/ /g,"_"),l.target="_blank",t.appendChild(l),8<o.children.length&&o.firstChild.remove();var c=null;m?o.appendChild(t):((c=Math.floor(8*Math.random()))===k&&(c=(c+1)%9),o.insertBefore(t,o.children.item(c)),k=c)},p=[function(n,t){setTimeout(function(){if(!speechSynthesis.speaking&&!speechSynthesis.pending){var e=new SpeechSynthesisUtterance;e.addEventListener("start",function(){g(n,t.lang)}),e.text=n.title,t&&(e.voice=t),u.checked?e.volume=100:e.volume=0,speechSynthesis.speak(e)}},0)}];!function(){if(e.fullscreenEnabled?d.addEventListener("change",function(){d.checked?e.body.requestFullscreen():e.exitFullscreen()}):(d.remove(),a('label[for="fullscreen"]').remove()),new EventSource("https://stream.wikimedia.org/v2/stream/recentchange").onmessage=function(e){var n=JSON.parse(e.data);"edit"!==n.type||n.bot||0!==n.namespace||"wikidatawiki"===n.wiki||function(n){var e=n.wiki.replace("wiki","");n.language=e;var t=h[e]||!1;f(h)?g(n,e):t&&p.forEach(function(e){return e(n,t)})}(n)},u.addEventListener("click",function(){var e=new SpeechSynthesisUtterance(u.checked?"Sound on":"Sound off");speechSynthesis.speak(e),h=v(!0),f(h)&&(h=v(!1)),speechSynthesis.onvoiceschanged=function(){h=v(!0),f(h)&&(h=v(!1))}}),"getWakeLock"in i){var t=a("#keep-awake");t.style.display="block",t.labels[0].style.display="block";var r=null;i.getWakeLock("screen").then(function(e){r=e;var n=null;t.addEventListener("click",function(){return function(){if(n)return n.cancel(),n=null;n=r.createRequest()}(),console.log("Wake lock is "+(r.active?"active":"not active"))})}).catch(function(e){return console.error("Could not obtain wake lock",e)})}else if("WakeLock"in c){var n=a("#keep-awake");n.style.display="block",n.labels[0].style.display="block";var l=new AbortController;n.addEventListener("click",function(){return n.checked?function(){var e=(l=new AbortController).signal;c.WakeLock.request("screen",{signal:e}).catch(function(e){"AbortError"===e.name?console.log("Wake Lock was aborted"):console.error(e.name,e.message),n.checked=!1}),console.log("Wake Lock is active"),n.checked=!0}():l.abort()})}}()}(document,window,navigator,document.querySelector.bind(document),document.createElement.bind(document));