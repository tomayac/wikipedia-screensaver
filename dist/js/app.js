"use strict";!function(e){function n(n,t){var r=e.createEvent("Event");r.initEvent(n,!0,!1),t.dispatchEvent(r)}function t(n){return function(t,s){function i(){t(),e.removeEventListener(r.events.change,i,!1)}function c(){s(new TypeError),e.removeEventListener(r.events.error,c,!1)}n!==l.exit||e[r.element]?(e.addEventListener(r.events.change,i,!1),e.addEventListener(r.events.error,c,!1)):setTimeout(function(){s(new TypeError)},1)}}var r,s,i={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},l=i.w3;for(s in i)if(i[s].enabled in e){r=i[s];break}l.enabled in e||!r||(e.addEventListener(r.events.change,function(t){t.stopPropagation(),t.stopImmediatePropagation(),e[l.enabled]=e[r.enabled],e[l.element]=e[r.element],n(l.events.change,t.target)},!1),e.addEventListener(r.events.error,function(e){n(l.events.error,e.target)},!1),e[l.enabled]=e[r.enabled],e[l.element]=e[r.element],e[l.exit]=function(){var n=e[r.exit]();return!n&&Promise?new Promise(t(l.exit)):n},Element.prototype[l.request]=function(){var e=this[r.request].apply(this,arguments);return!e&&Promise?new Promise(t(l.request)):e})}(document),function(e,n,t){var r=n("#tiles-container"),s=n("#sound"),i=n("#fullscreen"),l={},c=0,a=function(e){return 0===Object.keys(e).length&&JSON.stringify(e)===JSON.stringify({})},o=function(e){var n={};return speechSynthesis.getVoices().filter(function(n){return!e||/^Google/.test(n.name)}).map(function(e){n[e.lang.substr(0,2)]=e}),n},u=function(e){var n=e.wiki.replace("wiki","");e.language=n;var t=l[n]||!1;a(l)?m(e,n):t&&d.forEach(function(n){return n(e,t)})},m=function(e,n){var s=Math.floor,i=Math.random,l=t("div");l.className="tile",l.style.backgroundColor=("rgb(\n        "+s(255*i())+",\n        "+s(255*i())+",\n        "+s(255*i())+")").replace(/\n/g,"").replace(/\s/g,"");var a=t("img");a.src="img/"+n.split("-")[0]+".svg",a.className="flag",l.appendChild(a);var o=t("a");o.className="label",o.textContent=""+e.title,o.href=e.server_url+"/wiki/"+e.title.replace(/ /g,"_"),o.target="_blank",l.appendChild(o),r.children.length>8&&r.firstChild.remove();var u=Math.floor(8*Math.random());u===c&&(u=(u+1)%9),c=u,r.insertBefore(l,r.children.item(u))},d=[function(e,n){setTimeout(function(){if(!speechSynthesis.speaking&&!speechSynthesis.pending){var t=new SpeechSynthesisUtterance;t.addEventListener("start",function(){m(e,n.lang)}),t.text=e.title,n&&(t.voice=n),s.checked?t.volume=100:t.volume=0,speechSynthesis.speak(t)}},0)}];e.fullscreenEnabled?i.addEventListener("change",function(){i.checked?e.body.requestFullscreen():e.exitFullscreen()}):(i.remove(),n('label[for="fullscreen"]').remove()),new EventSource("https://stream.wikimedia.org/v2/stream/recentchange").onmessage=function(e){var n=JSON.parse(e.data);"edit"!==n.type||n.bot||0!==n.namespace||"wikidatawiki"===n.wiki||u(n)},s.addEventListener("click",function(){var e=new SpeechSynthesisUtterance("Click");speechSynthesis.speak(e),l=o(!0),a(l)&&(l=o(!1)),speechSynthesis.onvoiceschanged=function(){l=o(!0),a(l)&&(l=o(!1))}}),l=o(!0),a(l)&&(l=o(!1)),speechSynthesis.onvoiceschanged=function(){l=o(!0),a(l)&&(l=o(!1))}}(document,document.querySelector.bind(document),document.createElement.bind(document));