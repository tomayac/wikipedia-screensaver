"use strict";!function(e){function n(n,t){var r=e.createEvent("Event");r.initEvent(n,!0,!1),t.dispatchEvent(r)}function t(t){t.stopPropagation(),t.stopImmediatePropagation(),e[o.enabled]=e[l.enabled],e[o.element]=e[l.element],n(o.events.change,t.target)}function r(e){n(o.events.error,e.target)}function s(n){return function(t,r){function s(){t(),e.removeEventListener(l.events.change,s,!1)}function i(){r(new TypeError),e.removeEventListener(l.events.error,i,!1)}return n!==o.exit||e[l.element]?(e.addEventListener(l.events.change,s,!1),void e.addEventListener(l.events.error,i,!1)):void setTimeout(function(){r(new TypeError)},1)}}var l,i,c=!0,a={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},o=a.w3;for(i in a)if(a[i].enabled in e){l=a[i];break}return!c||o.enabled in e||!l||(e.addEventListener(l.events.change,t,!1),e.addEventListener(l.events.error,r,!1),e[o.enabled]=e[l.enabled],e[o.element]=e[l.element],e[o.exit]=function(){var n=e[l.exit]();return!n&&Promise?new Promise(s(o.exit)):n},Element.prototype[o.request]=function(){var e=this[l.request].apply(this,arguments);return!e&&Promise?new Promise(s(o.request)):e}),l}(document),function(e,n,t){var r="https://wikipedia-edits.herokuapp.com/sse",s=9,l=n("#tiles-container"),i=n("#sound"),c=n("#fullscreen"),a={},o=0,u=function(e){return 0===Object.keys(e).length&&JSON.stringify(e)===JSON.stringify({})},d=function(e){var n={};return speechSynthesis.getVoices().filter(function(n){return!e||/^Google/.test(n.name)}).map(function(e){n[e.lang.substr(0,2)]=e}),n},m=function(e){var n=JSON.parse(e.data),t=n.language,r=a&&a[t]||!1;r&&(n.article=n.article.replace(/_/g," "),f.forEach(function(e){return e(n,r)}))},v=function(e,n){setTimeout(function(){if(!speechSynthesis.speaking&&!speechSynthesis.pending){var t=new SpeechSynthesisUtterance;t.addEventListener("start",function(){h(e,n.lang)}),t.text=e.article,n&&(t.voice=n),i.checked?t.volume=100:t.volume=0,speechSynthesis.speak(t)}},0)},h=function(e,n){var r=Math.floor,i=Math.random,c=t("div");c.className="tile",c.style.backgroundColor=("rgb(\n        "+r(255*i())+",\n        "+r(255*i())+",\n        "+r(255*i())+")").replace(/\n/g,"").replace(/\s/g,"");var a=t("img");a.src="img/"+n.split("-")[0]+".svg",a.className="flag",c.appendChild(a);var u=t("div");u.className="label",u.textContent=""+e.article,c.appendChild(u),l.children.length>s-1&&l.firstChild.remove();var d=Math.floor(Math.random()*(s-1));d===o&&(d=(d+1)%s),o=d,l.insertBefore(c,l.children.item(d))},f=[v];!function(){e.fullscreenEnabled?c.addEventListener("change",function(){c.checked?e.body.requestFullscreen():e.exitFullscreen()}):(c.remove(),n('label[for="fullscreen"]').remove());var t=new EventSource(r);t.addEventListener("message",m),i.addEventListener("click",function(){var e=new SpeechSynthesisUtterance("Click");speechSynthesis.speak(e),a=d(!0),u(a)&&(a=d(!1)),speechSynthesis.onvoiceschanged=function(){a=d(!0),u(a)&&(a=d(!1))}}),a=d(!0),u(a)&&(a=d(!1)),speechSynthesis.onvoiceschanged=function(){a=d(!0),u(a)&&(a=d(!1))}}()}(document,document.querySelector.bind(document),document.createElement.bind(document));