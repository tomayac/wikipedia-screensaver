"use strict";!function(r){var l,e,n={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},i=n.w3;for(e in n)if(n[e].enabled in r){l=n[e];break}function t(e,n){var t=r.createEvent("Event");t.initEvent(e,!0,!1),n.dispatchEvent(t)}function s(e){return function(n,t){e!==i.exit||r[l.element]?(r.addEventListener(l.events.change,function e(){n(),r.removeEventListener(l.events.change,e,!1)},!1),r.addEventListener(l.events.error,function e(){t(new TypeError),r.removeEventListener(l.events.error,e,!1)},!1)):setTimeout(function(){t(new TypeError)},1)}}i.enabled in r||!l||(r.addEventListener(l.events.change,function(e){e.stopPropagation(),e.stopImmediatePropagation(),r[i.enabled]=r[l.enabled],r[i.element]=r[l.element],t(i.events.change,e.target)},!1),r.addEventListener(l.events.error,function(e){t(i.events.error,e.target)},!1),r[i.enabled]=r[l.enabled],r[i.element]=r[l.element],r[i.exit]=function(){var e=r[l.exit]();return!e&&Promise?new Promise(s(i.exit)):e},Element.prototype[i.request]=function(){var e=this[l.request].apply(this,arguments);return!e&&Promise?new Promise(s(i.request)):e})}(document),function(r,l,i,a){var o=i("#tiles-container"),s=i("#sound"),c=i("#fullscreen"),u={},d=0,m=function(e){return 0===Object.keys(e).length&&JSON.stringify(e)===JSON.stringify({})},v=function(n){var t={};return speechSynthesis.getVoices().filter(function(e){return!n||/^Google/.test(e.name)}).map(function(e){t[e.lang.substr(0,2)]=e}),t},f=function(e,n){var t=Math.floor,r=Math.random,l=a("div");l.className="tile",l.style.backgroundColor=("rgb(\n        "+t(255*r())+",\n        "+t(255*r())+",\n        "+t(255*r())+")").replace(/\n/g,"").replace(/\s/g,"");var i=a("img");i.src="img/"+n.split("-")[0]+".svg",i.className="flag",l.appendChild(i);var s=a("a");s.className="label",s.textContent=""+e.title,s.href=e.server_url+"/wiki/"+e.title.replace(/ /g,"_"),s.target="_blank",l.appendChild(s),8<o.children.length&&o.firstChild.remove();var c=Math.floor(8*Math.random());c===d&&(c=(c+1)%9),d=c,o.insertBefore(l,o.children.item(c))},h=[function(n,t){setTimeout(function(){if(!speechSynthesis.speaking&&!speechSynthesis.pending){var e=new SpeechSynthesisUtterance;e.addEventListener("start",function(){f(n,t.lang)}),e.text=n.title,t&&(e.voice=t),s.checked?e.volume=100:e.volume=0,speechSynthesis.speak(e)}},0)}];!function(){if(r.fullscreenEnabled?c.addEventListener("change",function(){c.checked?r.body.requestFullscreen():r.exitFullscreen()}):(c.remove(),i('label[for="fullscreen"]').remove()),new EventSource("https://stream.wikimedia.org/v2/stream/recentchange").onmessage=function(e){var n=JSON.parse(e.data);"edit"!==n.type||n.bot||0!==n.namespace||"wikidatawiki"===n.wiki||function(n){var e=n.wiki.replace("wiki","");n.language=e;var t=u[e]||!1;m(u)?f(n,e):t&&h.forEach(function(e){return e(n,t)})}(n)},s.addEventListener("click",function(){var e=new SpeechSynthesisUtterance("Click");speechSynthesis.speak(e),u=v(!0),m(u)&&(u=v(!1)),speechSynthesis.onvoiceschanged=function(){u=v(!0),m(u)&&(u=v(!1))}}),"getWakeLock"in l){var e=i("#keep-awake");e.style.display="block",e.labels[0].style.display="block";var n=null;l.getWakeLock("screen").then(function(e){n=e}).catch(function(e){return console.error("Could not obtain wake lock",e)});var t=null;e.addEventListener("click",function(){return function(){if(t)return t.cancel(),t=null;t=n.createRequest()}(),console.log("Wake lock is "+(n.active?"active":"not active"))})}}()}(document,navigator,document.querySelector.bind(document),document.createElement.bind(document));